START TRANSACTION;

-- Rename existing columns and modify data types
ALTER TABLE PlayerStats
    CHANGE COLUMN PlayerID SteamId BIGINT UNSIGNED NOT NULL,
    CHANGE COLUMN PlayerName Name VARCHAR(255) NULL,
    MODIFY COLUMN Kills INT NOT NULL DEFAULT 0,
    MODIFY COLUMN Deaths INT NOT NULL DEFAULT 0,
    MODIFY COLUMN Headshots INT NOT NULL DEFAULT 0,
    MODIFY COLUMN Zombies INT NOT NULL DEFAULT 0,
    MODIFY COLUMN MegaZombies INT NOT NULL DEFAULT 0,
    MODIFY COLUMN Resources INT NOT NULL DEFAULT 0,
    MODIFY COLUMN Harvests INT NOT NULL DEFAULT 0,
    MODIFY COLUMN Fish INT NOT NULL DEFAULT 0,
    MODIFY COLUMN LastUpdated DATETIME NOT NULL DEFAULT (UTC_TIMESTAMP());

-- Add new columns
ALTER TABLE PlayerStats
    ADD COLUMN PVPDeaths INT NOT NULL DEFAULT 0,
    ADD COLUMN PVEDeaths INT NOT NULL DEFAULT 0,
    ADD COLUMN Animals INT NOT NULL DEFAULT 0,
    ADD COLUMN Structures INT NOT NULL DEFAULT 0,
    ADD COLUMN Barricades INT NOT NULL DEFAULT 0,
    ADD COLUMN Playtime BIGINT UNSIGNED NOT NULL DEFAULT 0,
    ADD COLUMN UIDisabled BOOLEAN NULL;

-- Migrate Deaths data
UPDATE PlayerStats SET PVPDeaths = Deaths;

-- Drop old Deaths column
ALTER TABLE PlayerStats DROP COLUMN Deaths;

-- Modify primary key
ALTER TABLE PlayerStats 
    DROP PRIMARY KEY,
    ADD CONSTRAINT PK_PlayerStats_SteamId PRIMARY KEY (SteamId);

COMMIT;